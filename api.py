from ocrmac import ocrmac
from flask import Flask, render_template, request
from flask_cors import cross_origin
from PIL import Image
import io, base64
import ddddocr

app = Flask(__name__)

@app.route('/ocr', methods=['POST'])
@cross_origin()
def ocr_api():
    imgBase64 = request.json.get('img')
    #imgBase64 = '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=='
    print(imgBase64)
    img = Image.open(io.BytesIO(base64.decodebytes(bytes(imgBase64, "utf-8"))))

    #res = ocrmac.OCR(img, language_preference=['en-US'], recognition_level='accurate').recognize()
    #print(res)
    #return res[0][0]

    ocr = ddddocr.DdddOcr()
    res = ''.join(ocr.classification(img))
    return res
if __name__ == '__main__':
    app.run(host="0.0.0.0", port=8089)
